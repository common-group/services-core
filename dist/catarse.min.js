/*
    A Mithril.js plugin to authenticate requests against PostgREST
    Copyright (c) 2007 - 2015 Diogo Biazus
    Licensed under the MIT license (http://digitalbush.com/projects/masked-input-plugin/#license)
    Version: 1.0.0
*/
window.c=function(a){return{models:{},pages:{},admin:{error:a.prop()},h:{}}}(window.m),window.c.h=function(a,b){var c=function(a,c){return c=c||"DD/MM/YYYY",a?b(a).format(c):"no date"},d=function(a,c){var d=b(a,c||"DD/MM/YYYY");return d.isValid()?d:b(a)},e=function(a,b){return function(c,d,e){if(null===c||void 0===c)return null;var f="\\d(?=(\\d{"+(e||3)+"})+"+(d>0?"\\D":"$")+")",g=c.toFixed(Math.max(0,~~d));return(b?g.replace(".",b):g).replace(new RegExp(f,"g"),"$&"+(a||","))}},f=e(".",","),g=function(b,c){var d=a.prop(b);return d.toggle=function(){d(d()===c?b:c)},d},h=function(){return a('img[alt="Loader"][src="https://s3.amazonaws.com/catarse.files/loader.gif"]')};return{momentify:c,momentFromString:d,formatNumber:f,toggleProp:g,loader:h}}(window.m,window.moment),window.c.models=function(a){var b=a.postgrest.model("contribution_details",["id","contribution_id","user_id","project_id","reward_id","payment_id","permalink","project_name","project_img","user_name","user_profile_img","email","key","value","installments","installment_value","state","anonymous","payer_email","gateway","gateway_id","gateway_fee","gateway_data","payment_method","project_state","has_rewards","pending_at","paid_at","refused_at","reward_minimum_value","pending_refund_at","refunded_at","created_at","is_second_slip"]),c=a.postgrest.model("team_totals",["member_count","countries","total_contributed_projects","total_cities","total_amount"]),d=a.postgrest.model("team_members",["name","img","id","total_contributed_projects","total_amount_contributed"]);return d.pageSize(40),{contributionDetail:b,teamTotal:c,teamMember:d}}(window.m),window.c.admin.Contributions=function(a,b){var c=b.admin;return{controller:function(){var a=c.contributionListVM,b=c.contributionFilterVM;return{listVM:a,filterVM:b,submit:function(){return a.firstPage(b.parameters()).then(null,function(a){c.error(a.message)}),!1}}},view:function(d){return[a.component(b.AdminFilter,{form:d.filterVM.formDescriber,submit:d.submit}),c.error()?a(".card.card-error.u-radius.fontweight-bold",c.error()):a.component(b.AdminList,{vm:d.listVM})]}}}(window.m,window.c),window.c.admin.contributionFilterVM=function(a,b,c){var d=a.postgrest.filtersVM({full_text_index:"@@",state:"eq",gateway:"eq",value:"between",created_at:"between"});return d.formDescriber=[{type:"main",data:{vm:d.full_text_index,placeholder:"Busque por projeto, email, Ids do usuário e do apoio..."}},{type:"dropdown",data:{label:"Com o estado",name:"state",vm:d.state,options:[{value:"",option:"Qualquer um"},{value:"paid",option:"paid"},{value:"refused",option:"refused"},{value:"pending",option:"pending"},{value:"pending_refund",option:"pending_refund"},{value:"refunded",option:"refunded"},{value:"chargeback",option:"chargeback"},{value:"deleted",option:"deleted"}]}},{type:"dropdown",data:{label:"gateway",name:"gateway",vm:d.gateway,options:[{value:"",option:"Qualquer um"},{value:"Pagarme",option:"Pagarme"},{value:"MoIP",option:"MoIP"},{value:"PayPal",option:"PayPal"},{value:"Credits",option:"Créditos"}]}},{type:"numberRange",data:{label:"Valores entre",first:d.value.gte,last:d.value.lte}},{type:"dateRange",data:{label:"Período do apoio",first:d.created_at.gte,last:d.created_at.lte}}],d.state(""),d.gateway(""),d.order({id:"desc"}),d.created_at.lte.toFilter=function(){return b.momentFromString(d.created_at.lte()).endOf("day").format("")},d.created_at.gte.toFilter=function(){return b.momentFromString(d.created_at.gte()).format()},d.full_text_index.toFilter=function(){return c(d.full_text_index())},d}(window.m,window.c.h,window.replaceDiacritics),window.c.admin.contributionListVM=function(a,b){return a.postgrest.paginationVM(b.contributionDetail.getPageWithToken)}(window.m,window.c.models),window.c.AdminDetail=function(a,b){return{controller:function(){return{displayRequestRefundDropDown:b.ToggleDiv.toggler(),displayRefundDropDown:b.ToggleDiv.toggler(),displayTransferContributionDropDown:b.ToggleDiv.toggler(),displayChangeRewardDropDown:b.ToggleDiv.toggler(),displatAnonDropDown:b.ToggleDiv.toggler()}},view:function(c,d){var e=d.contribution;return a("#admin-contribution-detail-box",[a(".divider.u-margintop-20.u-marginbottom-20"),a(".w-row.u-marginbottom-30.w-hidden",[a(".w-col.w-col-2",[a("button.btn.btn-small.btn-terciary",{onclick:c.displayRequestRefundDropDown.toggle},"Pedir reembolso"),a.component(b.ToggleDiv,{display:c.displayRequestRefundDropDown,content:a('.dropdown-list.card.u-radius.dropdown-list-medium.zindex-10[id="transfer"]',[a(".fontsize-smaller.fontweight-semibold.u-text-center.u-marginbottom-20","Quer efetuar o reembolso?"),a("button.btn.btn-small","Solicitar reembolso")])})]),a(".w-col.w-col-2",[a("button.btn.btn-small.btn-terciary",{onclick:c.displayRefundDropDown.toggle},"Estornar"),a.component(b.ToggleDiv,{display:c.displayRefundDropDown,content:a(".dropdown-list.card.u-radius.dropdown-list-medium.zindex-10",[a(".fontsize-smaller.fontweight-semibold.u-text-center.u-marginbottom-20","Quer efetuar o estorno?"),a("button.btn.btn-small","Solicitar estorno")])})]),a(".w-col.w-col-2",[a("button.btn.btn-small.btn-terciary.btn-desactivated","2a via")]),a(".w-col.w-col-2",[a("button.btn.btn-small.btn-terciary",{onclick:c.displayTransferContributionDropDown.toggle},"Transferir apoio"),a.component(b.ToggleDiv,{display:c.displayTransferContributionDropDown,content:a(".dropdown-list.card.u-radius.dropdown-list-medium.zindex-10",[a(".w-form",[a("form",[a("label","Id do novo apoiador:"),a('input.w-input.text-field[placeholder="ex: 129908"][type="text"]'),a('input.w-button.btn.btn-small[type="submit"][value="Transferir"]')])])])})]),a(".w-col.w-col-2",[a("button.btn.btn-small.btn-terciary",{onclick:c.displayChangeRewardDropDown.toggle},"Trocar recompensa"),a.component(b.ToggleDiv,{display:c.displayChangeRewardDropDown,content:a('.dropdown-list.card.u-radius.dropdown-list-medium.zindex-10[id="transfer"]',{style:{display:"none"}},[a(".w-form",[a("form",[a(".w-radio",[a('input.w-radio-input[type="radio"][value="Radio"]'),a("label.w-form-label","R$ 10")]),a(".w-radio",[a('input.w-radio-input[type="radio"][value="Radio"]'),a('label.w-form-label[for="radio"]',"R$ 10")]),a(".w-radio",[a('input.w-radio-input[type="radio"][value="Radio"]'),a("label.w-form-label","R$ 10")]),a(".w-radio",[a('input.w-radio-input[type="radio"][value="Radio"]'),a("label.w-form-label","R$ 10")]),a(".w-radio",[a('input.w-radio-input[type="radio"][value="Radio"]'),a("label.w-form-label","R$ 10")])])])])})]),a(".w-col.w-col-2",[a("button.btn.btn-small.btn-terciary",{onclick:c.displatAnonDropDown.toggle},"Anonimato"),a.component(b.ToggleDiv,{display:c.displatAnonDropDown,content:a(".dropdown-list.card.u-radius.dropdown-list-medium.zindex-10",[a(".w-form",[a("form",[a(".w-radio",[a('input.w-radio-input[type="radio"]'),a("label.w-form-label","Anônimo")]),a(".w-radio",[a('input.w-radio-input[type="radio"][value="Radio"]'),a("label.w-form-label","Público")])])])])})])]),a(".w-row.card.card-terciary.u-radius",[a.component(b.AdminTransaction,{contribution:e}),a.component(b.AdminTransactionHistory,{contribution:e}),a.component(b.AdminReward,{contribution:e,key:e.key})])])}}}(window.m,window.c),window.c.AdminFilter=function(a,b,c,d){return{controller:function(){return{toggler:d.toggleProp(!1,!0)}},view:function(d,e){var f=function(c){return{main:b.component(a.FilterMain,c),dropdown:b.component(a.FilterDropdown,c),numberRange:b.component(a.FilterNumberRange,c),dateRange:b.component(a.FilterDateRange,c)}},g=c.findWhere(e.form,{type:"main"});return b("#admin-contributions-filter.w-section.page-header",[b(".w-container",[b(".fontsize-larger.u-text-center.u-marginbottom-30","Apoios"),b(".w-form",[b("form",{onsubmit:e.submit},[f(g.data).main,b(".u-marginbottom-20.w-row",b('button.w-col.w-col-12.fontsize-smallest.link-hidden-light[type="button"][style="background: none; border: none; outline: none; text-align: left;"]',{onclick:d.toggler.toggle},"Filtros avançados  >")),d.toggler()?b("#advanced-search.w-row.admin-filters",[c.map(e.form,function(a){return"main"!==a.type?f(a.data)[a.type]:""})]):""])])])])}}}(window.c,window.m,window._,window.c.h),window.c.AdminItem=function(a,b,c){return{controller:function(a){var b,d,e,f,g=a.contribution;return b=function(){return g.user_profile_img||"/assets/catarse_bootstrap/user.jpg"},d=function(){switch(g.state){case"paid":return".text-success";case"refunded":return".text-refunded";case"pending":case"pending_refund":return".text-waiting";default:return".text-error"}},e=function(){switch(g.payment_method){case"BoletoBancario":return".fa-barcode";case"CartaoDeCredito":return".fa-credit-card";default:return".fa-question"}},f=c.ToggleDiv.toggler(),{userProfile:b,stateClass:d,paymentMethodClass:e,displayDetailBox:f}},view:function(d,e){var f=e.contribution;return a(".w-clearfix.card.u-radius.u-marginbottom-20.results-admin-contributions",[a(".w-row",[a(".w-col.w-col-4",[a(".w-row",[a(".w-col.w-col-3.w-col-small-3.u-marginbottom-10",[a('img.user-avatar[src="'+d.userProfile()+'"]')]),a(".w-col.w-col-9.w-col-small-9",[a(".fontweight-semibold.fontsize-smaller.lineheight-tighter.u-marginbottom-10",[a('a.alt-link[target="_blank"][href="/users/'+f.user_id+'"]',f.user_name)]),a(".fontsize-smallest","Usuário: "+f.user_id),a(".fontsize-smallest.fontcolor-secondary","Catarse: "+f.email),a(".fontsize-smallest.fontcolor-secondary","Gateway: "+f.payer_email)])])]),a(".w-col.w-col-4",[a(".w-row",[a(".w-col.w-col-3.w-col-small-3.u-marginbottom-10",[a("img.thumb-project.u-radius[src="+f.project_img+"][width=50]")]),a(".w-col.w-col-9.w-col-small-9",[a(".fontweight-semibold.fontsize-smaller.lineheight-tighter.u-marginbottom-10",[a('a.alt-link[target="_blank"][href="/'+f.permalink+'"]',f.project_name)]),a(".fontsize-smallest.fontweight-semibold",f.project_state),a(".fontsize-smallest.fontcolor-secondary",b.momentify(f.project_online_date)+" a "+b.momentify(f.project_expires_at))])])]),a(".w-col.w-col-2",[a(".fontweight-semibold.lineheight-tighter.u-marginbottom-10.fontsize-small","R$"+f.value),a(".fontsize-smallest.fontcolor-secondary",b.momentify(f.created_at,"DD/MM/YYYY HH:mm[h]")),a(".fontsize-smallest",["ID do Gateway: ",a('a.alt-link[target="_blank"][href="https://dashboard.pagar.me/#/transactions/'+f.gateway_id+'"]',f.gateway_id)])]),a(".w-col.w-col-2",[a(".fontsize-smallest.lineheight-looser.fontweight-semibold",[a("span.fa.fa-circle"+d.stateClass())," "+f.state]),a(".fontsize-smallest.fontweight-semibold",[a("span.fa"+d.paymentMethodClass())," ",a('a.link-hidden[href="#"]',f.payment_method)]),a.component(c.PaymentBadge,{contribution:f,key:f.key})])]),a('a.w-inline-block.arrow-admin.fa.fa-chevron-down.fontcolor-secondary[data-ix="show-admin-cont-result"][href="javascript:void(0);"]',{onclick:d.displayDetailBox.toggle}),a.component(c.ToggleDiv,{display:d.displayDetailBox,content:a.component(c.AdminDetail,{contribution:f,key:f.key})})])}}}(window.m,window.c.h,window.c),window.c.AdminList=function(a,b,c){return{controller:function(a){!a.vm.collection().length&&a.vm.firstPage&&a.vm.firstPage().then(null,function(a){c.error(a.message)})},view:function(d,e){return a(".w-section.section",[a(".w-container",[a(".w-row.u-marginbottom-20",[a(".w-col.w-col-9",[a(".fontsize-base",[a("span.fontweight-semibold",e.vm.total())," apoios encontrados"])])]),a("#admin-contributions-list.w-container",[e.vm.collection().map(function(b){return a.component(c.AdminItem,{contribution:b,key:b.key})}),a(".w-section.section",[a(".w-container",[a(".w-row",[a(".w-col.w-col-2.w-col-push-5",[e.vm.isLoading()?b.loader():a("button#load-more.btn.btn-medium.btn-terciary",{onclick:e.vm.nextPage},"Carregar mais")])])])])])])])}}}(window.m,window.c.h,window.c),window.c.AdminReward=function(a,b,c){return{view:function(d,e){var f=e.contribution.reward||{},g=parseInt(f.paid_count)+parseInt(f.waiting_payment_count);return a(".w-col.w-col-4",[a(".fontweight-semibold.fontsize-smaller.lineheight-tighter.u-marginbottom-20","Recompensa"),a(".fontsize-smallest.lineheight-looser",c.isEmpty(f)?"Apoio sem recompensa.":["ID: "+f.id,a("br"),"Valor mínimo: R$"+b.formatNumber(f.minimum_value,2,3),a("br"),a.trust("Disponíveis: "+g+" / "+(f.maximum_contributions||"&infin;")),a("br"),"Aguardando confirmação: "+f.waiting_payment_count,a("br"),"Descrição: "+f.description])])}}}(window.m,window.c.h,window._),window.c.AdminTransactionHistory=function(a,b,c){return{controller:function(a){var d=a.contribution,e=c.reduce([{date:d.paid_at,name:"Apoio confirmado"},{date:d.pending_refund_at,name:"Reembolso solicitado"},{date:d.refunded_at,name:"Estorno realizado"},{date:d.created_at,name:"Apoio criado"},{date:d.refused_at,name:"Apoio cancelado"},{date:d.deleted_at,name:"Apoio excluído"},{date:d.chargeback_at,name:"Chargeback"}],function(a,c){return null!==c.date&&void 0!==c.date?(c.originalDate=c.date,c.date=b.momentify(c.date,"DD/MM/YYYY, HH:mm"),a.concat(c)):a},[]);return{orderedEvents:c.sortBy(e,"originalDate")}},view:function(b){return a(".w-col.w-col-4",[a(".fontweight-semibold.fontsize-smaller.lineheight-tighter.u-marginbottom-20","Histórico da transação"),b.orderedEvents.map(function(b){return a(".w-row.fontsize-smallest.lineheight-looser.date-event",[a(".w-col.w-col-6",[a(".fontcolor-secondary",b.date)]),a(".w-col.w-col-6",[a("div",b.name)])])})])}}}(window.m,window.c.h,window._),window.c.AdminTransaction=function(a,b){return{view:function(c,d){var e=d.contribution;return a(".w-col.w-col-4",[a(".fontweight-semibold.fontsize-smaller.lineheight-tighter.u-marginbottom-20","Detalhes do apoio"),a(".fontsize-smallest.lineheight-looser",["Valor: R$"+b.formatNumber(e.value,2,3),a("br"),"Taxa: R$"+b.formatNumber(e.gateway_fee,2,3),a("br"),"Anônimo: "+(e.anonymous?"Sim":"Não"),a("br"),"Id pagamento: "+e.gateway_id,a("br"),"Apoio: "+e.contribution_id,a("br"),"Chave: \n",a("br"),e.key,a("br"),"Meio: "+e.gateway,a("br"),"Operadora: "+(e.gateway_data&&e.gateway_data.acquirer_name),a("br"),function(){return e.is_second_slip?[a('a.link-hidden[href="#"]',"Boleto bancário")," ",a("span.badge","2a via")]:void 0}()])])}}}(window.m,window.c.h),window.c.FilterDateRange=function(a){return{view:function(b,c){return a(".w-col.w-col-3.w-col-small-6",[a('label.fontsize-smaller[for="'+c.index+'"]',c.label),a(".w-row",[a(".w-col.w-col-5.w-col-small-5.w-col-tiny-5",[a('input.w-input.text-field.positive[id="'+c.index+'"][type="text"]',{onchange:a.withAttr("value",c.first),value:c.first()})]),a(".w-col.w-col-2.w-col-small-2.w-col-tiny-2",[a(".fontsize-smaller.u-text-center.lineheight-looser","e")]),a(".w-col.w-col-5.w-col-small-5.w-col-tiny-5",[a('input.w-input.text-field.positive[type="text"]',{onchange:a.withAttr("value",c.last),value:c.last()})])])])}}}(window.m),window.c.FilterDropdown=function(a,b){return{view:function(c,d){return a(".w-col.w-col-3.w-col-small-6",[a('label.fontsize-smaller[for="'+d.index+'"]',d.label),a('select.w-select.text-field.positive[id="'+d.index+'"]',{onchange:a.withAttr("value",d.vm),value:d.vm()},[b.map(d.options,function(b){return a('option[value="'+b.value+'"]',b.option)})])])}}}(window.m,window._),window.c.FilterMain=function(a){return{view:function(b,c){return a(".w-row",[a(".w-col.w-col-10",[a('input.w-input.text-field.positive.medium[placeholder="'+c.placeholder+'"][type="text"]',{onchange:a.withAttr("value",c.vm),value:c.vm()})]),a(".w-col.w-col-2",[a('input#filter-btn.btn.btn-large.u-marginbottom-10[type="submit"][value="Buscar"]')])])}}}(window.m),window.c.FilterNumberRange=function(a){return{view:function(b,c){return a(".w-col.w-col-3.w-col-small-6",[a('label.fontsize-smaller[for="'+c.index+'"]',c.label),a(".w-row",[a(".w-col.w-col-5.w-col-small-5.w-col-tiny-5",[a('input.w-input.text-field.positive[id="'+c.index+'"][type="text"]',{onchange:a.withAttr("value",c.first),value:c.first()})]),a(".w-col.w-col-2.w-col-small-2.w-col-tiny-2",[a(".fontsize-smaller.u-text-center.lineheight-looser","e")]),a(".w-col.w-col-5.w-col-small-5.w-col-tiny-5",[a('input.w-input.text-field.positive[type="text"]',{onchange:a.withAttr("value",c.last),value:c.last()})])])])}}}(window.m),window.c.PaymentBadge=function(a){return{controller:function(b){var c=b.contribution,d=null;return d=function(){if(c.gateway_data)switch(c.gateway.toLowerCase()){case"moip":return{first_digits:c.gateway_data.cartao_bin,last_digits:c.gateway_data.cartao_final,brand:c.gateway_data.cartao_bandeira};case"pagarme":return{first_digits:c.gateway_data.card_first_digits,last_digits:c.gateway_data.card_last_digits,brand:c.gateway_data.card_brand}}},{displayPaymentMethod:function(){switch(c.payment_method.toLowerCase()){case"boletobancario":return a("span#boleto-detail","");case"cartaodecredito":var b=d();return b?a("#creditcard-detail.fontsize-smallest.fontcolor-secondary.lineheight-tight",[b.first_digits+"******"+b.last_digits,a("br"),b.brand+" "+c.installments+"x"]):""}}}},view:function(b){return a(".fontsize-smallest.fontcolor-secondary.lineheight-tight",[b.displayPaymentMethod()])}}}(window.m),window.c.TeamMembers=function(a,b,c){return{controller:function(){var d={collection:b.prop([])},e=function(b,c){return a.map(a.range(Math.ceil(b.length/c)),function(a){return b.slice(a*c,(a+1)*c)})};return c.teamMember.getPage().then(function(a){d.collection(e(a,4))}),{vm:d}},view:function(c){return b("#team-members-static.w-section.section",[b(".w-container",[a.map(c.vm.collection(),function(c){return b(".w-row.u-text-center",[a.map(c,function(a){return b(".team-member.w-col.w-col-3.w-col-small-3.w-col-tiny-6.u-marginbottom-40",[b('a.alt-link[href="/users/'+a.id+'"]',[b('img.thumb.big.u-round.u-marginbottom-10[src="'+a.img+'"]'),b(".fontweight-semibold.fontsize-base",a.name)]),b(".fontsize-smallest.fontcolor-secondary","Apoiou "+a.total_contributed_projects+" projetos")])})])})])])}}}(window._,window.m,window.c.models),window.c.TeamTotal=function(a,b,c){return{controller:function(){var b={collection:a.prop([])};return c.teamTotal.getRow().then(function(a){b.collection(a)}),{vm:b}},view:function(c){return a("#team-total-static.w-section.section-one-column.u-margintop-40.u-text-center.u-marginbottom-20",[c.vm.collection().map(function(c){return a(".w-container",[a(".w-row",[a(".w-col.w-col-2"),a(".w-col.w-col-8",[a(".fontsize-base.u-marginbottom-30","Hoje somos "+c.member_count+" pessoas espalhadas por "+c.total_cities+" cidades em "+c.countries.length+" países ("+c.countries.toString()+")! O Catarse é independente, sem investidores, de código aberto e construído com amor. Nossa paixão é construir um ambiente onde cada vez mais projetos possam ganhar vida."),a(".fontsize-larger.lineheight-tight.text-success","Nossa equipe, junta, já apoiou R$"+b.formatNumber(c.total_amount)+" para "+c.total_contributed_projects+" projetos!")]),a(".w-col.w-col-2")])])})])}}}(window.m,window.c.h,window.c.models),window.c.ToggleDiv=function(a,b){return{toggler:function(){return b.toggleProp("none","block")},controller:function(a){return{vm:{display:a.display}}},view:function(b,c){return a(".toggleDiv",{style:{transition:"all .1s ease-out",overflow:"hidden",display:b.vm.display()}},[c.content])}}}(window.m,window.c.h),window.c.pages.Team=function(a,b){return{view:function(){return a("#static-team-app",[a.component(b.TeamTotal),a.component(b.TeamMembers)])}}}(window.m,window.c);