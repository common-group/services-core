name: Build test environment
on: 
  push:
    paths:
    - 'infrastructure/builder/**'
    - '.github/workflows/build-builder.yaml'
    branches:
    - develop
jobs:
  build:
    name: Build the builder
    runs-on: ubuntu-latest
    steps:
    - name: Build, tag, and push image
      uses: azure/docker-login@v1
      with:
        username: soapbubble
        password: ${{ secrets.DOCKERHUB_TOKEN }}
      env:
        IMAGE_TAG: ${{ github.sha }}
      run: |
        docker build -t soapbubble/aws-cloud-builder:$IMAGE_TAG -f infrastructure/builder/Dockerfile infrastructure/builder/
        docker push soapbubble/aws-cloud-builder:$IMAGE_TAG
